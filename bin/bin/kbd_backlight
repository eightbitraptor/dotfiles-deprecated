#!/usr/bin/env bash

DIRECTION=$1

CURRENT_VAL=$(dbus-send --print-reply                                              \
                        --system                                                   \
                        --type=method_call                                         \
                        --dest="org.freedesktop.UPower"                            \
                               "/org/freedesktop/UPower/KbdBacklight"              \
                               "org.freedesktop.UPower.KbdBacklight.GetBrightness" \
              | awk '/int32/ {print $NF}' )

MAXIMUM_VAL=$(dbus-send --print-reply                                                 \
                        --system                                                      \
                        --type=method_call                                            \
                        --dest="org.freedesktop.UPower"                               \
                               "/org/freedesktop/UPower/KbdBacklight"                 \
                               "org.freedesktop.UPower.KbdBacklight.GetMaxBrightness" \
              | awk '/int32/ {print $NF}' )

if [[ "$CURRENT_VAL" -eq "$MAXIMUM_VAL" ]]; then
  dbus-send                                                    \
    --system                                                   \
    --type=method_call                                         \
    --dest="org.freedesktop.UPower"                            \
           "/org/freedesktop/UPower/KbdBacklight"              \
           "org.freedesktop.UPower.KbdBacklight.SetBrightness" \
           int32:0
else
  NEW_VAL=$((++CURRENT_VAL))

  dbus-send                                                    \
    --system                                                   \
    --type=method_call                                         \
    --dest="org.freedesktop.UPower"                            \
           "/org/freedesktop/UPower/KbdBacklight"              \
           "org.freedesktop.UPower.KbdBacklight.SetBrightness" \
           int32:$NEW_VAL
fi
